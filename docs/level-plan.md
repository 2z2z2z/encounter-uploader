# План реализации новой архитектуры типов уровней

## Общие принципы реализации

- Новая архитектура создается полностью с нуля в отдельной области файловой системы
- Старая архитектура остается нетронутой для справки и взятия рабочих фрагментов кода
- 100% использование PrimeVue компонентов
- Динамическое построение компонентов на основе конфигов
- Сохранение совместимости с существующими API пейлоадами
- Создание новых унифицированных форматов экспорта/импорта для блоков (табов)
- Не разбивать сущности на множество файлов без необходимости
- Строгое соблюдение @CLAUDE.md, особенно правил написания кода и "Always Works™"
- Переиспользование существующих компонентов где это целесообразно

## Детальная структура файлов новой архитектуры

```
frontend/src/components/level-system-v2/
├── bases/
│   ├── fields/                    # База полей
│   │   ├── index.ts              # Экспорт всех полей + типы
│   │   ├── fieldDefinitions.ts   # Определения полей (метаданные)
│   │   └── fieldComponents.ts    # Компоненты для рендеринга в таблице
│   ├── controls/                 # База контрол-сниппетов
│   │   ├── index.ts              # Экспорт всех контролов
│   │   ├── SectorModeControl.vue # "Закрытие уровня"
│   │   ├── BonusTimeControl.vue  # "Бонусное время (ч, м, с)"
│   │   ├── ClosedSectorControl.vue # "Название закрытого сектора"
│   │   ├── OpenSectorControl.vue # "Заполнить открытые сектора"
│   │   ├── SectorNameControl.vue # "Название секторов"
│   │   ├── BonusNameControl.vue  # "Название бонусов"
│   │   ├── DelayControl.vue      # "Задержка (ч, м, с)"
│   │   ├── LimitControl.vue      # "Ограничение (ч, м, с)"
│   │   ├── BonusTaskControl.vue  # "Бонусные задания"
│   │   ├── HintControl.vue       # "Подсказки (по факту выполнения)"
│   │   └── BonusLevelsControl.vue # "Уровни бонусов"
│   └── buttons/                  # База кнопок
│       ├── index.ts              # Экспорт всех кнопок
│       ├── NavigationButtons.vue # Левая часть футера (Назад)
│       ├── FunctionalButtons.vue # Центральная часть футера (Очистить, Экспорт, Импорт, Предпросмотр, Добавить коды)
│       └── ActionButtons.vue     # Правая часть футера (Залить задание, секторы, бонусы)
├── payloads/                     # Пейлоады
│   ├── index.ts                  # Экспорт всех пейлоадов
│   ├── TaskPayload.ts           
│   ├── SectorPayload.ts         
│   └── BonusPayload.ts          
├── configs/                      # Конфиги типов уровней
│   ├── index.ts                  # Экспорт + реестр типов
│   ├── olymp.ts                  # Конфиг "Олимпийка"
│   └── type100500.ts             # Конфиг "100500"
├── components/                   # Компоненты слотов
│   ├── LevelHeader.vue           # Слот "шапка"
│   ├── LevelTabs.vue             # Слот "блоки (табы)" - новый слот
│   ├── LevelControlPanel.vue     # Слот "контрол-панель"
│   ├── LevelContent.vue          # Слот "таблица контента"
│   ├── LevelFooter.vue           # Слот "подвал с кнопками"
│   └── LevelUploadPage.vue       # Общий шаблон страницы
├── composables/                  # Композаблы для логики
│   ├── useLevelFields.ts         # Логика работы с полями
│   ├── useLevelControls.ts       # Логика контрол-панели
│   └── useLevelPayloads.ts       # Логика пейлоадов
├── store/                        # Store для v2
│   └── index.ts                  # Новый store для новой архитектуры
└── types/                        # Типы TypeScript
    ├── index.ts                  # Экспорт всех типов
    ├── fields.ts                 # Типы для полей
    ├── configs.ts                # Типы для конфигов
    └── payloads.ts               # Типы для пейлоадов
```

## Этапы реализации

### ☐ Шаг 1: Очистка и базовая структура
- Удаление старой попытки перехода (`frontend/src/components/level-system`)
- Создание папочной структуры для новой архитектуры
- Создание базовых индексных файлов

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок

### ☐ Шаг 2: Создание TypeScript типов
- Создание всех интерфейсов и типов для новой архитектуры
- Определение типов для полей, контролов, кнопок, конфигов

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок

### ☐ Шаг 3: Создание store для новой архитектуры
- Создание нового Pinia store для level-system-v2
- Реализация логики управления состоянием без привязки к конкретным типам

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок

### ☐ Шаг 4: Добавление тестового роутинга
- Создание роутов `/v2/test/:levelType` для тестирования
- Создание заглушки компонента для тестирования доступности

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок
- ☐ Тестирование UI с playwright - доступность новых роутов

### ☐ Шаг 5: Создание базового общего шаблона
- Создание LevelUploadPage.vue с основными слотами (включая новый слот для табов)
- Реализация каркаса без конкретной логики

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок
- ☐ Тестирование UI с playwright - отображение базовой структуры

### ☐ Шаг 6: Реализация слота LevelHeader
- Создание компонента LevelHeader.vue
- Интеграция с существующими мета-данными (переиспользование логики)

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок
- ☐ Тестирование UI с playwright - отображение заголовка

### ☐ Шаг 7: Реализация слота LevelTabs
- Создание компонента LevelTabs.vue с PrimeVue Tabs
- Поддержка одного таба (для Олимпийки) и множественных (для 100500)

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок
- ☐ Тестирование UI с playwright - работа табов

### ☐ Шаг 8: Создание базы полей - определения
- Создание fieldDefinitions.ts со всеми полями из документа
- Только метаданные полей без компонентов

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок

### ☐ Шаг 9: Создание базы полей - компоненты (часть 1)
- Реализация компонентов для полей: Answer, Sector, Bonus
- Портирование из существующего Answers.vue

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок

### ☐ Шаг 10: Создание базы полей - компоненты (часть 2)  
- Реализация компонентов: BonusTime, ClosedSector, OpenSector
- Портирование из существующего Answers.vue

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок

### ☐ Шаг 11: Создание базы полей - компоненты (часть 3)
- Реализация компонентов для 100500: BonusLevels, Delay, Limit
- Создание с нуля на PrimeVue

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок

### ☐ Шаг 12: Создание базы полей - компоненты (часть 4)
- Реализация компонентов: SectorName, BonusName, BonusTask, Hint
- Создание с нуля на PrimeVue

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок

### ☐ Шаг 13: Реализация слота LevelContent
- Создание LevelContent.vue с DataTable
- Интеграция с базой полей для динамического рендеринга колонок

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок
- ☐ Тестирование UI с playwright - отображение таблицы с полями

### ☐ Шаг 14: Создание базы контрол-сниппетов (часть 1)
- Реализация SectorModeControl, BonusTimeControl
- Портирование из OlympBase.vue

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок

### ☐ Шаг 15: Создание базы контрол-сниппетов (часть 2)  
- Реализация ClosedSectorControl, OpenSectorControl
- Портирование из OlympBase.vue

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок

### ☐ Шаг 16: Создание базы контрол-сниппетов (часть 3)
- Реализация контролов для 100500: SectorNameControl, BonusNameControl
- Создание с нуля на PrimeVue

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок

### ☐ Шаг 17: Создание базы контрол-сниппетов (часть 4)  
- Реализация DelayControl, LimitControl, BonusTaskControl, HintControl, BonusLevelsControl
- Создание с нуля на PrimeVue

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок

### ☐ Шаг 18: Реализация слота LevelControlPanel
- Создание LevelControlPanel.vue
- Динамическое отображение контрол-сниппетов на основе конфига

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок
- ☐ Тестирование UI с playwright - работа контрол-панели

### ☐ Шаг 19: Создание базы кнопок - навигационные
- Реализация NavigationButtons.vue (кнопка "Назад")

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок

### ☐ Шаг 20: Создание базы кнопок - функциональные
- Реализация FunctionalButtons.vue (Очистить, Экспорт, Импорт, Предпросмотр, Добавить коды)
- Интеграция с существующими модальными окнами (ExportModal, ImportModal, PreviewModal)

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок

### ☐ Шаг 21: Создание базы кнопок - экшн-кнопки
- Реализация ActionButtons.vue (Залить задание, Залить секторы, Залить бонусы)
- Подготовка к интеграции с пейлоадами

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок

### ☐ Шаг 22: Реализация слота LevelFooter  
- Создание LevelFooter.vue с тремя областями (левая, центральная, правая)
- Интеграция всех групп кнопок

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок
- ☐ Тестирование UI с playwright - работа футера с кнопками

### ☐ Шаг 23: Создание TaskPayload
- Реализация логики формирования пейлоада для заливки заданий
- Портирование из services/uploader.ts

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок

### ☐ Шаг 24: Создание SectorPayload
- Реализация логики формирования пейлоада для заливки секторов
- Портирование из services/uploader.ts

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок

### ☐ Шаг 25: Создание BonusPayload
- Реализация логики формирования пейлоада для заливки бонусов
- Портирование из services/uploader.ts

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок

### ☐ Шаг 26: Создание конфига "Олимпийка"
- Создание конфига olymp.ts с подтипами и настройками
- Определение полей, контролов, кнопок для Олимпийки

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок

### ☐ Шаг 27: Создание реестра типов уровней
- Создание системы регистрации типов уровней
- Интеграция конфига "Олимпийка"

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок

### ☐ Шаг 28: Полная интеграция "Олимпийка"
- Подключение всех компонентов для работы с "Олимпийкой"
- Тестирование всех подтипов (15, 31, 63, 127 секторов)

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок
- ☐ Тестирование UI с playwright - полный функционал "Олимпийка"

### ☐ Шаг 29: Создание конфига "100500"
- Создание конфига type100500.ts с настройками
- Определение полей, контролов, кнопок для 100500

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок

### ☐ Шаг 30: Полная интеграция "100500"
- Подключение всех компонентов для работы с "100500"
- Тестирование уникального функционала (ручное добавление кодов, табы)

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок
- ☐ Тестирование UI с playwright - полный функционал "100500"

### ☐ Шаг 31: Финальный рефакторинг
- Анализ и устранение дублированного кода
- Оптимизация производительности
- Добавление JSDoc комментариев к сложным участкам

**Проверки:**
- ☐ ESLint без ошибок
- ☐ Сборка проекта без ошибок
- ☐ Тестирование UI с playwright - финальная проверка всех функций

---

**ВАЖНО!** Этот документ будет актуализироваться после каждого выполненного шага с добавлением технических деталей реализации.